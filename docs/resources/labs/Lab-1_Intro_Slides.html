<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>EDS 217: Python for Environmental Data Science - Lab 1: Estimating Basin Waterbalance</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="styles/activities.css">
</head>

<body class="floating">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setting-up-the-lab" id="toc-setting-up-the-lab" class="nav-link active" data-scroll-target="#setting-up-the-lab">1. Setting up the Lab</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">2. Background</a>
  <ul class="collapse">
  <li><a href="#viewing-watershed-hydrography" id="toc-viewing-watershed-hydrography" class="nav-link" data-scroll-target="#viewing-watershed-hydrography">Viewing Watershed Hydrography</a></li>
  <li><a href="#viewing-watershed-hydrography-1" id="toc-viewing-watershed-hydrography-1" class="nav-link" data-scroll-target="#viewing-watershed-hydrography-1">Viewing Watershed Hydrography</a></li>
  <li><a href="#viewing-basin-topography-using-digital-elevation-data" id="toc-viewing-basin-topography-using-digital-elevation-data" class="nav-link" data-scroll-target="#viewing-basin-topography-using-digital-elevation-data">Viewing Basin Topography Using Digital Elevation Data</a></li>
  <li><a href="#a-catchment-as-a-physical-system" id="toc-a-catchment-as-a-physical-system" class="nav-link" data-scroll-target="#a-catchment-as-a-physical-system">A Catchment as a Physical System</a></li>
  <li><a href="#obtaining-precipitation-discharge-and-rainfall-data-for-a-usgs-station" id="toc-obtaining-precipitation-discharge-and-rainfall-data-for-a-usgs-station" class="nav-link" data-scroll-target="#obtaining-precipitation-discharge-and-rainfall-data-for-a-usgs-station">Obtaining Precipitation, Discharge, and Rainfall data for a USGS station</a>
  <ul class="collapse">
  <li><a href="#discharge-data-for-our-station" id="toc-discharge-data-for-our-station" class="nav-link" data-scroll-target="#discharge-data-for-our-station">Discharge Data for our Station</a></li>
  <li><a href="#precipitation-data-for-our-station" id="toc-precipitation-data-for-our-station" class="nav-link" data-scroll-target="#precipitation-data-for-our-station">Precipitation Data for our Station</a></li>
  <li><a href="#evapotranspiration-data-for-our-station" id="toc-evapotranspiration-data-for-our-station" class="nav-link" data-scroll-target="#evapotranspiration-data-for-our-station">Evapotranspiration Data for our Station</a></li>
  </ul></li>
  <li><a href="#hydromet-plotting-tools" id="toc-hydromet-plotting-tools" class="nav-link" data-scroll-target="#hydromet-plotting-tools">Hydromet Plotting tools</a></li>
  <li><a href="#extra-stuff-land-use-data" id="toc-extra-stuff-land-use-data" class="nav-link" data-scroll-target="#extra-stuff-land-use-data">Extra Stuff: Land Use Data</a></li>
  </ul></li>
  <li><a href="#the-end" id="toc-the-end" class="nav-link" data-scroll-target="#the-end">The End</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<hr>
<h4 class="anchored"> <a href="../../">Return to Course Home Page</a></h4>
<hr>

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 1: Estimating Basin Waterbalance</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="setting-up-the-lab" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-the-lab">1. Setting up the Lab</h2>
<ul>
<li><a href="https://hydrodata.readthedocs.io/en/v0.9.2/"><code>pygeohydro</code></a> is a Python library designed to aid in watershed analysis.</li>
<li>Pygeohydro is capable of downloading, preprocessing, and visualizing climatological, hydrological, and geographical datasets pertaining to a given watershed.</li>
<li>Supported datasets include: Daymet climate, USGS streamflow, and data from the National Land Cover Dataset.</li>
</ul>
<section id="pygeohydro-formerly-hydrodata" class="level4">
<h4 class="anchored" data-anchor-id="pygeohydro-formerly-hydrodata">2.1 PyGeoHydro (formerly hydrodata)</h4>
<ul>
<li>It’s easy to use <code>pygeohydro</code> to get streamflow data for any USGS gauge.<br>
</li>
<li>Your lab work will focus on a stream gauge near to some favorite (or personally interesting) place in the U.S.</li>
</ul>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pygeohydro <span class="im">import</span> Station</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pygeohydro.datasets <span class="im">as</span> hds</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>) <span class="co"># Don't output warnings</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="background" class="level1">
<h1>2. Background</h1>
<ul>
<li>The main concept we will be considering is mass balance.</li>
<li>Along with energy and momentum, mass is one of the three consitutents that are conserved in environmental systems.</li>
<li>Physical systems can be written as a statement of mass, energy, or momentum.</li>
<li>The key to creating these statements (or equations) of balance is determining the bounds of the system (it’s geographic extent and structure) as well as the specific processes acting across those boundaries.</li>
</ul>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>station_id <span class="op">=</span> <span class="st">'11138500'</span>  <span class="co"># This is a USGS station ID. Later, I will show you how to find one on your own!</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> <span class="st">'2015-10-01'</span>     <span class="co"># Start date is the Oct. 1, 2016 which is the start of the 2016-2017 water year.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> <span class="st">'2018-09-30'</span>       <span class="co"># End date is the Sept 30, 2019 which is the end of the 2018-2019 water year.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create our watershed object using the station_id, start, and end dates</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>wshed <span class="op">=</span> Station(start<span class="op">=</span>start, end<span class="op">=</span>end, station_id<span class="op">=</span>station_id, data_dir<span class="op">=</span><span class="st">"../data/lab_1/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="viewing-watershed-hydrography" class="level2">
<h2 class="anchored" data-anchor-id="viewing-watershed-hydrography">Viewing Watershed Hydrography</h2>
<p>We can use some of the dataset interfaces provided by <code>pygeohydro</code> to map the stream channels within our watershed.</p>
<p>Access to the NHDPlus dataset is provided by the <code>NLDI</code> object, which is part of <code>pygeohydro</code>’s <code>datasets</code> class, which we imported earlier as <code>hds</code>. To query these datasets, we use the following code:</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the hydrography associated with this station using the wshed.station_id:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>tributaries <span class="op">=</span> hds.NLDI.tributaries(wshed.station_id)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>main_channel <span class="op">=</span> hds.NLDI.main(wshed.station_id)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>stations <span class="op">=</span> hds.NLDI.stations(wshed.station_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="viewing-watershed-hydrography-1" class="level2">
<h2 class="anchored" data-anchor-id="viewing-watershed-hydrography-1">Viewing Watershed Hydrography</h2>
<p>We can then plot these data using internal <code>pygeohydro</code> plotting functions, which are special versions of <code>matplotlib</code> plotting functions with extra features for viewing our stream channels.</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a plot of the basin boundaries, main channel, tributaries, and station locations. </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> wshed.basin.plot(color<span class="op">=</span><span class="st">'white'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, zorder<span class="op">=</span><span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>tributaries.plot(ax<span class="op">=</span>ax, label<span class="op">=</span><span class="st">'Tributaries'</span>, zorder<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>main_channel.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'green'</span>, lw<span class="op">=</span><span class="dv">3</span>, label<span class="op">=</span><span class="st">'Main'</span>, zorder<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>stations.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'All stations'</span>, marker<span class="op">=</span><span class="st">'s'</span>, zorder<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)<span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>ax.figure.set_dpi(<span class="dv">100</span>)<span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">u'Sisquoc River near Sisquoc, CA (</span><span class="sc">{lon:.2f}</span><span class="ch">\U000000b0</span><span class="st">W, </span><span class="sc">{lat:.2f}</span><span class="ch">\U000000b0</span><span class="st">N)'</span>.<span class="bu">format</span>(</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    lon<span class="op">=</span><span class="bu">abs</span>(wshed.lon),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    lat<span class="op">=</span>wshed.lat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="viewing-basin-topography-using-digital-elevation-data" class="level2">
<h2 class="anchored" data-anchor-id="viewing-basin-topography-using-digital-elevation-data">Viewing Basin Topography Using Digital Elevation Data</h2>
<p>We can get a better sense of this topography using Digital Elevation Data released by the USGS.</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grab the watershed Digital Elevation Data from the USGS and display it:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dem <span class="op">=</span> hds.nationalmap_dem(wshed.geometry, resolution<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>dem.plot(size<span class="op">=</span><span class="dv">8</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="a-catchment-as-a-physical-system" class="level2">
<h2 class="anchored" data-anchor-id="a-catchment-as-a-physical-system">A Catchment as a Physical System</h2>
<p>The water balance of a catchment is determined by the sum of inputs and outputs of water. If inputs are greater than outputs, the catchment is gaining water. If outputs are greater than inputs, the catchment is losing water. In the special case where outputs and inputs are equal, the catchment is neither gaining nor losing water, and the amount of water in the catchment is constant with time, meaning it is in <em>steady state</em>.</p>
<p>The change in storage of water in the catchment (<span class="math inline">\Delta S</span>, [m<span class="math inline">^3</span>]) can be written as:</p>
<p>$ S = P - ET - Q $</p>
<p>Usually, we calculate the water balance over discrete time intervals, <span class="math inline">\Delta t</span> (e.g.&nbsp;days, or years), in which case, the equation becomes:</p>
<p>$ = P(t) - ET(t) - Q(t) $</p>
<p>and we have implicitly re-defined the units of <span class="math inline">P</span>, <span class="math inline">ET</span>, and <span class="math inline">Q</span> to be mass per time, [m<span class="math inline">^3</span>/t].</p>
</section>
<section id="obtaining-precipitation-discharge-and-rainfall-data-for-a-usgs-station" class="level2">
<h2 class="anchored" data-anchor-id="obtaining-precipitation-discharge-and-rainfall-data-for-a-usgs-station">Obtaining Precipitation, Discharge, and Rainfall data for a USGS station</h2>
<p>So far, we’ve been able to define a catchment upstream of a USGS gauge and visualize basin stream networks and topography. In order to study our simple basin water balance, we will need to obtain data on each of the three main fluxes: <span class="math inline">Q</span>, <span class="math inline">P</span>, and <span class="math inline">ET</span>.</p>
<section id="discharge-data-for-our-station" class="level3">
<h3 class="anchored" data-anchor-id="discharge-data-for-our-station">Discharge Data for our Station</h3>
<p>The <code>pygeohydro</code> allows us to access streamflow data stored in the National Water Information System (<a href="https://www.usgs.gov/nwis-national-water-information-system">NWIS</a>), which contains water resource data for almost 1.5 million locations across the United States and US Territories.</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Q <span class="op">=</span> hds.nwis_streamflow(wshed.station_id, wshed.start, wshed.end)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>Q.columns <span class="op">=</span> [<span class="st">'Q [m^3/s]'</span>]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>Q.index.name <span class="op">=</span> <span class="st">'Datetime'</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>Q[<span class="st">'Dates'</span>] <span class="op">=</span> Q.index</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>Q.tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="precipitation-data-for-our-station" class="level3">
<h3 class="anchored" data-anchor-id="precipitation-data-for-our-station">Precipitation Data for our Station</h3>
<p>Unfortunately, most USGS streamflow gauges aren’t at locations where rainfall data is also collected. Even if they were, rainfall varies across even small basins, so we’d still need to have some idea of what the average rainfall was over the entire watershed. Helpfully, the <code>hydromet</code> library includes the ability to query the Daily Surface Weather and Climatological Summaries (<a href="https://daymet.ornl.gov">Daymet</a>), which is hosted at Oak Ridge National Laboratory’s (ORNL’s) Distributed Active Archive Center (DAAC).</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>daymet <span class="op">=</span> hds.daymet_byloc(wshed.lon, wshed.lat, start<span class="op">=</span>wshed.start, end<span class="op">=</span>wshed.end)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>daymet.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> pd.DataFrame(daymet[<span class="st">'prcp (mm/day)'</span>])</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>P.columns <span class="op">=</span> [<span class="st">'P [mm/day]'</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>P.index.name <span class="op">=</span> <span class="st">'Datetime'</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>P[<span class="st">'Dates'</span>] <span class="op">=</span> P.index</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>P.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="evapotranspiration-data-for-our-station" class="level3">
<h3 class="anchored" data-anchor-id="evapotranspiration-data-for-our-station">Evapotranspiration Data for our Station</h3>
<p>Evapotranspiration data is the hardest to obtain as there are very few direct observations of evapotranspiration (but we will work with some of these direct measurements in our next lab!). For this lab, we are going to use a model-based estimate of actual evapotranspiration called the Operational Simplified Surface Energy Balance (SSEBop) model, which was developed at the USGS’s Earth Resources Observation and Science (<a href="https://www.usgs.gov/centers/eros">EROS</a>) Center.</p>
<p>We can access the SSEBop model estimates of evapotranspiration using the <code>ssedopeta_byloc</code> method:</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's, load some SSEBop data that we've already downloaded from a csv using the pd.read_csv() command:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ET <span class="op">=</span> pd.read_csv(<span class="st">'../data/lab_1/SSEBop_11123500.csv'</span>, usecols<span class="op">=</span>[<span class="st">'ET [mm/day]'</span>, <span class="st">'datetime'</span>], index_col<span class="op">=</span><span class="st">'datetime'</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Just as with our P and Q data, we assign the index and create a column of dates.</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>ET.index.name <span class="op">=</span> <span class="st">'Datetime'</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>ET[<span class="st">'Dates'</span>] <span class="op">=</span> ET.index</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>ET.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="hydromet-plotting-tools" class="level2">
<h2 class="anchored" data-anchor-id="hydromet-plotting-tools">Hydromet Plotting tools</h2>
<p>The <code>hydrodata</code> package includes a handy utility for plotting streamflow and rainfall. I’ve modified this utility to give us a way to quickly look at the time series of our rainfall and streamflow data.</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize streamflow and rainfall data from our station</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plot_Q_and_P <span class="im">import</span> plot_Q_and_P</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>plot_Q_and_P({<span class="st">"Q"</span>: (Q[<span class="st">'Q [m^3/s]'</span>], wshed.drainage_area)}, P[<span class="st">'P [mm/day]'</span>], figsize<span class="op">=</span>(<span class="dv">13</span>,<span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="extra-stuff-land-use-data" class="level2">
<h2 class="anchored" data-anchor-id="extra-stuff-land-use-data">Extra Stuff: Land Use Data</h2>
<p>While we don’t use it in this lab, <code>hydrodata</code> also makes it possible to access land use and land cover data can be obtained from the Multi-Resolution Land Characteristics (MRLC) Consortium. By default the data are downloaded from NLCD 2016.</p>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.plot <span class="im">import</span> show</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> hydrodata <span class="im">import</span> plot <span class="im">as</span> hydroplot</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>cmap, norm, levels <span class="op">=</span> hydroplot.cover_legends()</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Download LULC data for this watershed</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>lulc <span class="op">=</span> hds.nlcd(wshed.geometry, resolution<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the watershed Land Cover and Canopy Cover for 2016</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>), dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>show(lulc[<span class="st">'cover'</span>], ax<span class="op">=</span>ax1, title<span class="op">=</span><span class="ss">f'Cover 2016'</span>, cmap<span class="op">=</span>cmap, norm<span class="op">=</span>norm)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>show(lulc[<span class="st">'canopy'</span>], ax<span class="op">=</span>ax2, title<span class="op">=</span><span class="ss">f'Canopy 2016'</span>, cmap<span class="op">=</span><span class="st">'Greens'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="the-end" class="level1">
<h1>The End</h1>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>