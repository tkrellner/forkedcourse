<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>EDS 217: Python for Environmental Data Science - Lab 2: Landscape Energy Balance</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="styles/activities.css">
</head>

<body class="floating">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#instructions" id="toc-instructions" class="nav-link active" data-scroll-target="#instructions">Instructions</a></li>
  <li><a href="#surface-energy-balance" id="toc-surface-energy-balance" class="nav-link" data-scroll-target="#surface-energy-balance">1. Surface Energy Balance</a>
  <ul class="collapse">
  <li><a href="#measuring-environmental-fluxes" id="toc-measuring-environmental-fluxes" class="nav-link" data-scroll-target="#measuring-environmental-fluxes">Measuring environmental fluxes</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  </ul></li>
  <li><a href="#the-radiation-budget" id="toc-the-radiation-budget" class="nav-link" data-scroll-target="#the-radiation-budget">2. The Radiation Budget ‚òÄÔ∏è</a>
  <ul class="collapse">
  <li><a href="#shortwave-radiation" id="toc-shortwave-radiation" class="nav-link" data-scroll-target="#shortwave-radiation">2.1. Shortwave radiation</a></li>
  <li><a href="#longwave-radiation" id="toc-longwave-radiation" class="nav-link" data-scroll-target="#longwave-radiation">2.2. Longwave radiation</a></li>
  <li><a href="#problems" id="toc-problems" class="nav-link" data-scroll-target="#problems">Problems</a>
  <ul class="collapse">
  <li><a href="#determine-the-albedo-of-the-landscape." id="toc-determine-the-albedo-of-the-landscape." class="nav-link" data-scroll-target="#determine-the-albedo-of-the-landscape.">2.1. Determine the albedo of the landscape.</a></li>
  <li><a href="#estimate-the-surface-temperature-of-the-earth-from-q_av" id="toc-estimate-the-surface-temperature-of-the-earth-from-q_av" class="nav-link" data-scroll-target="#estimate-the-surface-temperature-of-the-earth-from-q_av">2.2. Estimate the surface temperature of the earth from <span class="math inline">Q_{av}</span></a></li>
  <li><a href="#net-radiation" id="toc-net-radiation" class="nav-link" data-scroll-target="#net-radiation">2.3. Net radiation</a></li>
  <li><a href="#diurnal-radiation" id="toc-diurnal-radiation" class="nav-link" data-scroll-target="#diurnal-radiation">2.4. Diurnal radiation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#landscape-energy-budget" id="toc-landscape-energy-budget" class="nav-link" data-scroll-target="#landscape-energy-budget">3. Landscape energy budget üèûÔ∏è</a>
  <ul class="collapse">
  <li><a href="#ground-heat-flux" id="toc-ground-heat-flux" class="nav-link" data-scroll-target="#ground-heat-flux">3.1. Ground Heat Flux</a></li>
  <li><a href="#sensible-heat-flux" id="toc-sensible-heat-flux" class="nav-link" data-scroll-target="#sensible-heat-flux">3.2. Sensible Heat Flux üå°Ô∏è</a></li>
  <li><a href="#latent-heat-flux" id="toc-latent-heat-flux" class="nav-link" data-scroll-target="#latent-heat-flux">3.3. Latent Heat Flux üíß</a></li>
  <li><a href="#problems-1" id="toc-problems-1" class="nav-link" data-scroll-target="#problems-1">Problems</a>
  <ul class="collapse">
  <li><a href="#density-of-air" id="toc-density-of-air" class="nav-link" data-scroll-target="#density-of-air">3.1. Density of air</a></li>
  <li><a href="#calculate-h" id="toc-calculate-h" class="nav-link" data-scroll-target="#calculate-h">3.2. Calculate <span class="math inline">H</span></a></li>
  <li><a href="#latent-heat-flux-1" id="toc-latent-heat-flux-1" class="nav-link" data-scroll-target="#latent-heat-flux-1">3.3. Latent heat flux</a></li>
  <li><a href="#comparing-turbulent-fluxes" id="toc-comparing-turbulent-fluxes" class="nav-link" data-scroll-target="#comparing-turbulent-fluxes">3.4 Comparing turbulent fluxes</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#putting-it-all-together" id="toc-putting-it-all-together" class="nav-link" data-scroll-target="#putting-it-all-together">4. Putting it all together</a>
  <ul class="collapse">
  <li><a href="#residual-energy" id="toc-residual-energy" class="nav-link" data-scroll-target="#residual-energy">4.1. Residual energy</a></li>
  <li><a href="#rainfall" id="toc-rainfall" class="nav-link" data-scroll-target="#rainfall">4.2. Rainfall</a></li>
  <li><a href="#diurnal-radiation-sensible-heat-flux-and-latent-heat-flux" id="toc-diurnal-radiation-sensible-heat-flux-and-latent-heat-flux" class="nav-link" data-scroll-target="#diurnal-radiation-sensible-heat-flux-and-latent-heat-flux">4.3. Diurnal radiation, sensible heat flux, and latent heat flux</a></li>
  <li><a href="#average-residual-energy" id="toc-average-residual-energy" class="nav-link" data-scroll-target="#average-residual-energy">4.4. Average residual energy</a></li>
  <li><a href="#energy-balance-closure." id="toc-energy-balance-closure." class="nav-link" data-scroll-target="#energy-balance-closure.">4.5. Energy balance closure.</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<hr>
<h4 class="anchored"> <a href="../../">Return to Course Home Page</a></h4>
<hr>

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 2: Landscape Energy Balance</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><img src="./assets/mpala1.jpeg" alt="mpala" width="800"></p>
<p>In the last lab, we used mass balance concepts to calculate the water balance within a watershed. In this lab, will will use energy balance concepts to explore the fluxes of energy across a landscape (more specifically, <span class="math inline">\uparrow</span> this landscape!).</p>
<div class="boxhead3">
<pre><code>Lab 2 Contents</code></pre>
</div>
<div class="boxtext3">
<ul class="a">
<li>
<ol type="1">
<li>Surface Energy Balance
</li>
<ul class="b">
<li>
Background
</li>
</ul>
<li>
<ol start="2" type="1">
<li>The Radiation Budget
</li>
<ul class="b">
<li>
Shortwave radiation
</li>
<li>
Longwave radiation
</li>
<li>
Problems
</li>
</ul>
<li>
<ol start="3" type="1">
<li>Landscape Energy Budget
</li>
<ul class="b">
<li>
Ground heat flux
</li>
<li>
Sensible heat flux
</li>
<li>
Latent heat flux
</li>
<li>
Problems
</li>
</ul>
<li>
<ol start="4" type="1">
<li>Putting it all together
</li>
</ol></li></ol></li></ol></li></ol></li></ul>




</div>
<hr style="border-top: 0.2px solid gray; margin-top: 12pt; margin-bottom: 0pt">

<section id="instructions" class="level3">
<h3 class="anchored" data-anchor-id="instructions">Instructions</h3>
<p>Work through the exercise, writing code where indicated. For some of the questions, you may want to add a Markdown cell to discuss your answer. To run a cell, click on the cell and press ‚ÄúShift‚Äù + ‚ÄúEnter‚Äù or click the ‚ÄúRun‚Äù button in the toolbar at the top. Note: Do not restart the kernel and clear all outputs. If this happens, run the last cell in the notebook before proceeding.</p>
<p style="color:#408000; font-weight: bold">
üêç &nbsp; &nbsp; This symbol designates an important note about Python structure, syntax, or another quirk.
</p>
<p style="color:#443823; font-weight: bold">
üìä &nbsp; &nbsp; This symbol designates an important note about environmental data methods, sources, and access.
</p>
<p style="color:#008C96; font-weight: bold">
‚ñ∂Ô∏è &nbsp; &nbsp; This symbol designates a cell with code to be run.
</p>
<p style="color:#008C96; font-weight: bold">
‚úèÔ∏è &nbsp; &nbsp; This symbol designates a partially coded cell with an example.
</p>
<p style="color:#008C96; font-weight: bold">
üìö &nbsp; &nbsp; This symbol designates a practice question.
</p>
<hr style="border-top: 1px solid gray; margin-top: 24px; margin-bottom: 1px">

</section>
<section id="surface-energy-balance" class="level1">
<h1>1. Surface Energy Balance</h1>
<hr style="border-top: 0.5px solid gray; margin-top: 10pt; margin-bottom: 12pt">

<p>Much like mass balance, the energy balance of a system consists of the sum of inputs and outputs. While the mass balance terms can be discretized into obvious components (e.g.&nbsp;precipitation), the components of the Earth‚Äôs energy budget are <strong>fluxes</strong>, meaning that they consist of both inputs <em>and</em> outputs and can be either positive or negative, depending on environmental conditions. These fluxes are driven by four important processes: <strong>radiation</strong>, <strong>conduction</strong>, <strong>convection</strong>, and <strong>evaporation</strong>.</p>
<p>The largest and perhaps most obvious component of the Earth‚Äôs energy budget is the <strong>net radiation</strong>, <span class="math inline">R_n</span>, consisting of electromagnetic radiation that is <em>absorbed</em>, <em>reflected</em>, and <em>emitted</em> by the Earth‚Äôs surface. The surplus of incoming solar radiation provides excess energy for transport-driven processes at the Earth‚Äôs surface. Thermal conduction of heat energy within the ground leads to <strong>ground heat flux</strong>, <span class="math inline">G</span>. <strong>Sensible heat flux</strong>, <span class="math inline">H</span>, refers to the turbulent transfer of energy between the surface and the atmosphere via convective processes. <strong>Latent heat flux</strong>, <span class="math inline">\lambda E</span>, represents the loss of energy associated with phase changes between liquid water and water vapor through evaporation, transpiration, and condensation.</p>
<p><span class="math display">\begin{equation}
\tag{1.1}
    \frac{dQ}{dt} \ = \ R_n \ - \ H \ - \ \lambda E \ - \ G
\end{equation}</span></p>
<p>These energy fluxes (also referred to as <em>energy flux densities</em>) quantify the rate of energy transfer per unit area and are measured in units of J m<sup>-2</sup> s<sup>-1</sup> or W m<sup>-2</sup>.</p>
<p>Assuming the system is in <em>steady state</em>, a valid assumption over sufficiently long time scales, $ &nbsp;= &nbsp;0$, so we can rearrange Equation 1.1 as:</p>
<p><span class="math display">\begin{equation}
\tag{1.2}
    R_n \ = \ H \ + \ \lambda E \ + \ G
\end{equation}</span></p>
<section id="measuring-environmental-fluxes" class="level3">
<h3 class="anchored" data-anchor-id="measuring-environmental-fluxes">Measuring environmental fluxes</h3>
<p>In this lab, we will be using data collected from a micrometerological tower that uses <a href="https://en.wikipedia.org/wiki/Eddy_covariance">eddy covariance</a> techniques to measure turbulent fluxes in the atmospheric boundary layer. The physics of this method are too complex to get into here, but eddy covariance is one of the main ways of determining landscape energy balance. These ‚Äúflux towers‚Äù are equipped with sensors to measure wind speed and direction and gas (usually H<sub>2</sub>O and CO<sub>2</sub>) concentrations, and radiation (and usually numerous other sensors!) at very high frequencies (commonly 10 Hz or 10 times per second). These data are then used to calculate fluxes of gas, energy, and momentum across the landscape.</p>
<p>This short video provides a basic overview of eddy covariance, focusing on CO<sub>2</sub> fluxes. While we won‚Äôt be working with carbon fluxes in this lab, you can replace ‚ÄúCO<sub>2</sub>‚Äù with ‚ÄúH<sub>2</sub>O‚Äù to think about water vapor fluxes due to sensible and latent heat.</p>
<p><a href="https://youtu.be/CR4Anc8Mkas"><img src="./assets/ec_video.png" alt="ec_video" width="600"></a></p>
</section>
<section id="background" class="level3">
<h3 class="anchored" data-anchor-id="background">Background</h3>
<p>The data we‚Äôll work with in this lab come from a flux tower in central Kenya just a few kilometers north of the Equator. Like much of East Africa, the flux tower site is situated in a dryland savanna environment. As we saw in Exercise 3, there are two ‚Äúrainy‚Äù seasons in this part of Kenya, one beginning in March and another in October.</p>
<p><img src="./assets/mpalatower.jpeg" alt="tower" width="400"></p>
<p>In this lab, we‚Äôll look at the last five months of the year, August through December, encompassing the second wet season and compare this season between two years, 2016 and 2019.</p>
<p>As always, we‚Äôll start by importing the necessary libraries.</p>
<div class="run">
<pre><code>‚ñ∂Ô∏è &lt;b&gt; Run the cell below. &lt;/b&gt;</code></pre>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Imports</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In this lab, you will use data collected from the flux tower in Kenya to calculate the overall energy balance for this landscape, comparing eddy flux calculations to radiation data. The data are located in the <a href="../data">data</a> folder of the GitHub repository. The raw eddy covariance data have already been significantly pruned and pre-processed to allow for efficient calculations of turbulent fluxes in half-hourly averages. The data you will need for these calculations are located in a file called <a href="../data/lab_2/CR3000_SN4709_flux_ed.csv">CR3000_SN4709_flux_ed.csv</a>. These data include:</p>
<table class="table">
<colgroup>
<col style="width: 38%">
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Column name</th>
<th style="text-align: left;">Units</th>
<th style="text-align: left;">Symbol</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>P_a</strong></td>
<td style="text-align: left;"><span class="math inline">\text{kPa}</span></td>
<td style="text-align: left;"><span class="math inline">P_a</span></td>
<td style="text-align: left;">Air pressure</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>e</strong></td>
<td style="text-align: left;"><span class="math inline">\text{kPa}</span></td>
<td style="text-align: left;"><span class="math inline">e</span></td>
<td style="text-align: left;">Vapor pressure</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>T_a</strong></td>
<td style="text-align: left;"><span class="math inline">^{\circ}\text{C}</span></td>
<td style="text-align: left;"><span class="math inline">T_a</span></td>
<td style="text-align: left;">Air temperature</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>cov_Ts_Uz</strong></td>
<td style="text-align: left;"><span class="math inline">\text{K m s}^{-1}</span></td>
<td style="text-align: left;"><span class="math inline">\overline{w'T'}</span></td>
<td style="text-align: left;">Eddy covariance term for SHF</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>cov_h2o_Uz</strong></td>
<td style="text-align: left;"><span class="math inline">\text{g m}^{-2} \text{ s}^{-1}</span></td>
<td style="text-align: left;"><span class="math inline">\overline{w'c'_{_{\text{H}_2\text{O}}}}</span></td>
<td style="text-align: left;">Eddy covariance term for LHF</td>
</tr>
</tbody>
</table>
<p><br><br></p>
<p>The other file, <a href="../data/lab_2/CR5000_SN2446_upper_ed.csv">CR5000_SN2446_upper_ed.csv</a>, contains data from a net radiometer that you will use to assess your eddy covariance calculations. This file is organized as follows:</p>
<table class="table">
<colgroup>
<col style="width: 33%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Column name</th>
<th style="text-align: left;">Units</th>
<th style="text-align: left;">Symbol</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>DOY</strong></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Day of year</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>SW_in</strong></td>
<td style="text-align: left;"><span class="math inline">\text{W m}^{-2}</span></td>
<td style="text-align: left;"><span class="math inline">R^{\downarrow}_{_{SW}}</span></td>
<td style="text-align: left;">Incoming shortwave radiation</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>SW_out</strong></td>
<td style="text-align: left;"><span class="math inline">\text{W m}^{-2}</span></td>
<td style="text-align: left;"><span class="math inline">R^{\uparrow}_{_{SW}}</span></td>
<td style="text-align: left;">Outgoing shortwave radiation</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>LW_in</strong></td>
<td style="text-align: left;"><span class="math inline">\text{W m}^{-2}</span></td>
<td style="text-align: left;"><span class="math inline">R^{\downarrow}_{_{LW}}</span></td>
<td style="text-align: left;">Incoming longwave radiation</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>LW_out</strong></td>
<td style="text-align: left;"><span class="math inline">\text{W m}^{-2}</span></td>
<td style="text-align: left;"><span class="math inline">R^{\uparrow}_{_{LW}}</span></td>
<td style="text-align: left;">Outgoing longwave radiation</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>P_mm</strong></td>
<td style="text-align: left;"><span class="math inline">\text{mm}</span></td>
<td style="text-align: left;"><span class="math inline">P</span></td>
<td style="text-align: left;">Precipitation</td>
</tr>
</tbody>
</table>
<div class="run">
<pre><code>‚ñ∂Ô∏è &lt;b&gt; Run the cell below. &lt;/b&gt;</code></pre>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data import</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>flux <span class="op">=</span> pd.read_csv(<span class="st">'../data/lab_2/CR3000_SN4709_flux_ed.csv'</span>, index_col<span class="op">=</span><span class="dv">0</span>, parse_dates<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>rad <span class="op">=</span> pd.read_csv(<span class="st">'../data/lab_2/CR5000_SN2446_upper_ed.csv'</span>, index_col<span class="op">=</span><span class="dv">0</span>, parse_dates<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally, the following table contains values for several potentially useful constants, which have already been coded in the cell below.</p>

<table>
<thead>
<tr>
<th style="text-align:left;">
Constant
</th>
<th style="text-align:center;">
Symbol
</th>
<th style="text-align:left; width:158px">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Stefan-Boltzmann constant
</td>
<td style="text-align:center;">
<span class="math inline">\sigma</span>
</td>
<td>
<span class="math inline">5.67 \times 10^{-8} \text{ W m}^{-2} \text{ K}^{-4}</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Specific heat capacity of air
</td>
<td style="text-align:center;">
<span class="math inline">c_p</span>
</td>
<td>
<span class="math inline">1004.67 \text{ J kg}^{-1} \text{ K}^{-1}</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Ideal gas constant
</td>
<td style="text-align:center;">
<span class="math inline">R</span>
</td>
<td>
<span class="math inline">8.314 \text{ J mol}^{-1} \text{ K}^{-1}</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Latent heat of vaporization
</td>
<td style="text-align:center;">
<span class="math inline">\lambda_v</span>
</td>
<td>
<span class="math inline">2440 \text{ J g}^{-1}</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Molar mass of water
</td>
<td style="text-align:center;">
<span class="math inline">M_{_{\text{H}_2\text{O}}}</span>
</td>
<td>
<span class="math inline">18.01528 \text{ g mol}^{-1}</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Molar mass of dry air
</td>
<td style="text-align:center;">
<span class="math inline">M_{_{\text{air}}}</span>
</td>
<td>
<span class="math inline">28.9647 \text{ g mol}^{-1}</span>
</td>
</tr>
</tbody>

</table>
<div class="run">
<pre><code>‚ñ∂Ô∏è &lt;b&gt; Run the cell below. &lt;/b&gt;</code></pre>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Constants</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">5.67e-8</span>  <span class="co"># Stefan-Boltzmann constant, W m-2 K-4</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>c_p <span class="op">=</span> <span class="fl">1004.67</span>    <span class="co"># heat capacity, J kg-1 K-1</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span> <span class="fl">8.314</span>        <span class="co"># Ideal gas constant, J mol-1 K-1</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>lambda_v <span class="op">=</span> <span class="dv">2440</span>  <span class="co"># Latent heat of vaporization, J g-1</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>M_h2o <span class="op">=</span> <span class="fl">18.01528</span> <span class="co"># Molar mass of water, g mol-1</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>M_air <span class="op">=</span> <span class="fl">28.9647</span>  <span class="co"># Molar mass of dry air, g mol-1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="the-radiation-budget" class="level1">
<h1>2. The Radiation Budget ‚òÄÔ∏è</h1>
<hr style="border-top: 0.5px solid gray; margin-top: 10pt; margin-bottom: 12pt">

<p>The Earth‚Äôs radiation budget can be broken into <em>shortwave</em> and <em>longwave</em> components, referring to the wavelength of transmitted light. Each of these components consists of a flux of incoming (or ‚Äúdownwelling‚Äù) and outgoing (or ‚Äúupwelling‚Äù) energy. Thus, we can write the</p>
<p><span class="math display">\begin{equation}
\tag{2.1}
    R_n \ = \ R^{\downarrow}_{_{SW}} \, - \, R^{\uparrow}_{_{SW}} \, + \, R^{\downarrow}_{_{LW}} \, - \, R^{\uparrow}_{_{LW}}
\end{equation}</span></p>
<p>where the arrows denote the direction of the radiation. We‚Äôll explore each of these components in more detail below.</p>
<p><img src="./assets/em_spectrum.jpg" alt="spectrum" width="500"></p>
<section id="shortwave-radiation" class="level2">
<h2 class="anchored" data-anchor-id="shortwave-radiation">2.1. Shortwave radiation</h2>
<p>The vast majority of energy entering the Earth‚Äôs atmosphere is <strong>shortwave radiation</strong> from the sun, <span class="math inline">R^{\ \downarrow}_{_{SW}}</span>, and falls in the ultraviolet, visible, and infrared portions of the electromagnetic spectrum. As we saw in Exercise 1.1, the flux density of the sun‚Äôs energy at the Earth‚Äôs atmosphere, known as the <em>solar constant</em>, is about 1370 W m<sup>-2</sup>. This is the <em>maximum</em> value of <span class="math inline">R^{\downarrow}_{_{SW}}</span>, but this quantity can fluctuate based on seasonal and diurnal geometry, attenuation by the atmosphere, and the amount of clouds and aerosols in the atmosphere. Of the solar radiation that <em>does</em> pass through the atmosphere, about 30% is reflected by the Earth‚Äôs surface, leading to <strong>outgoing shortwave radiation, <span class="math inline">R^{\uparrow}_{_{SW}}</span></strong>. The ratio of reflected to incoming shortwave radiation is known as <strong>albedo</strong>, <span class="math inline">\alpha</span>.</p>
<p><span class="math display">\begin{equation}
\tag{2.2}
    \alpha \ = \ \frac{R^{\uparrow}_{_{SW}}}{R^{\downarrow}_{_{SW}}}
\end{equation}</span></p>
<p>Because ~30% of incoming solar radiation is reflected on average, the Earth‚Äôs average global albedo is 0.3. This value varies between 0 and 1, however, based on the surface. Dark objects like asphalt absorb most of the incident radiation causing them to have a very low albedo. In contrast, light objects like freshly fallen snow have an albedo close to 1 as they reflect nearly all incident energy.</p>
<p>Using Equation 2.2, we can write the net shortwave radiation (i.e.&nbsp;the difference between incoming and outgoing shortwave radiation) as</p>
<p><span class="math display">\begin{equation}
\tag{2.3}
    R^{\downarrow}_{_{SW}} \ - \ R^{\uparrow}_{_{SW}} \ = \ (1 \ - \ \alpha) R^{\downarrow}_{_{SW}}
\end{equation}</span></p>
</section>
<section id="longwave-radiation" class="level2">
<h2 class="anchored" data-anchor-id="longwave-radiation">2.2. Longwave radiation</h2>
<p>Some incoming solar radiation is absorbed by larger particles in the Earth‚Äôs atmosphere, causing the atmosphere to warm. The heat generated by this absorption is emitted in the far infrared portion of the elecromagnetic spectrum, some of which radiates to the surface to produce <strong>incoming longwave radiation, <span class="math inline">R^{\downarrow}_{_{LW}}</span></strong>. The value of <span class="math inline">R^{\downarrow}_{_{LW}}</span> varies depending on the temperature profile of the atmosphere and the amount of water vapor and other particles present. As the surface of the Earth heats up, thermal energy is re-emitted as <strong>outgoing longwave radiation, <span class="math inline">R^{\uparrow}_{_{LW}}</span></strong>. This quantity depends on the temperature and <strong>emissivity</strong> of the surface, <span class="math inline">\varepsilon</span>. Both incoming and outgoing longwave radiation can be calculated from the Stefan-Boltzmann law, which describes the energy emitted from an object in terms of its temperature:</p>
<p><span class="math display">\begin{equation}
\tag{2.4}
    j^* \ = \ \varepsilon \sigma T^{4}
\end{equation}</span></p>
<p>where <span class="math inline">\sigma</span> is the <strong>Stefan-Boltzman constant</strong> with a value of <span class="math inline">5.67 \times 10^{-8} \text{ W m}^{-2} \text{ K}^{-4}</span>.</p>
<p>Thus, we can rewrite Equation 2.1 to express net radiation in terms of these relationships in Equations 2.3 and 2.4:</p>
<p><span class="math display">\begin{equation}
\tag{2.5}
    R^{}_{n} \ = \ (1-\alpha) \ R^{\downarrow}_{_{SW}} \ + \ \varepsilon_a \sigma {T^{}_{a}}^{4} \ - \ \varepsilon_s \sigma {T^{}_{s}}^{4}
\end{equation}</span></p>
<p>where <span class="math inline">\varepsilon_a</span> and <span class="math inline">\varepsilon_s</span> are the emissivities and <span class="math inline">T_a</span> and <span class="math inline">T_s</span> are the temperatures (in Kelvin) of the air and the surface, respectively.</p>
<p>The sum of the incoming shortwave radiation (corrected for albedo) and incoming longwave radiation represents the <strong>total energy available to the system, <span class="math inline">Q_{av}</span></strong>. We can rewrite Equation 2.5 in terms of available energy:</p>
<p><span class="math display">\begin{equation}
\tag{2.6}
    Q_{av} \ = \ (1-\alpha) \ R^{\downarrow}_{_{SW}} \ + \ \varepsilon_a \sigma {T^{}_{a}}^{4} \ = \ R^{\downarrow}_{_{SW}} \, - \, R^{\uparrow}_{_{SW}} \, + \, R^{\downarrow}_{_{LW}}  \ = \varepsilon_s \sigma {T^{}_{s}}^{4}
\end{equation}</span></p>
<hr style="border-top: 0.5px solid gray; margin-top: 6pt; margin-bottom: 12pt">

</section>
<section id="problems" class="level2">
<h2 class="anchored" data-anchor-id="problems">Problems</h2>
<section id="determine-the-albedo-of-the-landscape." class="level3">
<h3 class="anchored" data-anchor-id="determine-the-albedo-of-the-landscape.">2.1. Determine the albedo of the landscape.</h3>
<div class="practice">
<pre><code>üìö  &lt;b&gt; Question 2.1. &lt;/b&gt; 
Calculate daily albedo values using the average daily $R^{\downarrow}_{_{SW}}$ and $R^{\uparrow}_{_{SW}}$ values. What is the mean daily albedo of the landscape over the entire dataset?</code></pre>
</div>
</section>
<section id="estimate-the-surface-temperature-of-the-earth-from-q_av" class="level3">
<h3 class="anchored" data-anchor-id="estimate-the-surface-temperature-of-the-earth-from-q_av">2.2. Estimate the surface temperature of the earth from <span class="math inline">Q_{av}</span></h3>
<div class="practice">
<pre><code>üìö  &lt;b&gt; Question 2.2. &lt;/b&gt; 
Calculate $Q_{av}$ from $R^{\downarrow}_{_{SW}}$, $R^{\uparrow}_{_{SW}}$, and $R^{\downarrow}_{_{LW}}$. Using the mean value of $Q_{av}$ over the entire dataset, use Equation 2.6 to calculate the apparent surface temperature of the earth, $T_s$, in both $^{\circ}$C and $^{\circ}$F assuming all of the available energy is used to heat the surface. Assume the surface has the same emissivity as the atmosphere, $\varepsilon_s \ = \ 0.95$.</code></pre>
</div>
</section>
<section id="net-radiation" class="level3">
<h3 class="anchored" data-anchor-id="net-radiation">2.3. Net radiation</h3>
<p>Now, calculate the actual net radiation from the dataset.</p>
<div class="practice">
<pre><code>üìö  &lt;b&gt; Question 2.3. &lt;/b&gt; 
Use Equation 2.1 and the actual values of outgoing longwave radiation to calculate net radiation. Plot net radiation from August to December for 2016 and 2019 on the same plot (Hint: use &lt;code&gt;rad.index.dayofyear&lt;/code&gt; on the x-axis to display the time series on top of one another). Label your plot appropriately.</code></pre>
</div>
</section>
<section id="diurnal-radiation" class="level3">
<h3 class="anchored" data-anchor-id="diurnal-radiation">2.4. Diurnal radiation</h3>
<p>Next, let‚Äôs look at the diurnal variation in radiation values. Pick a single day of your choosing and plot all four components of radiation, as well as net radiation. You can use a boolean mask on your <code>DataFrame</code> to select a single date. For instance, to select the 11th of October 2019:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>rad[rad.index.date <span class="op">==</span> datetime.date(<span class="dv">2019</span>,<span class="dv">10</span>,<span class="dv">11</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="practice">
<pre><code>üìö  &lt;b&gt; Question 2.4. &lt;/b&gt; 
Plot net radiation, as well as its four components, over the course of your chosen day. Which component is the largest? When is $R_n$ at its highest during the day? Its lowest? As always, be sure to label your plot appropriately.</code></pre>
</div>
</section>
</section>
</section>
<section id="landscape-energy-budget" class="level1">
<h1>3. Landscape energy budget üèûÔ∏è</h1>
<hr style="border-top: 0.5px solid gray; margin-top: 10pt; margin-bottom: 12pt">

<p>As we saw above, the amount of energy available to the Earth‚Äôs surface from radiation far exceeds the outgoing longwave radiation emitted by the surface, so there must be other processes cooling off the surface.</p>
<p>Energy flows follow a gradient a high to low concentration. We can describe the flow of energy, <span class="math inline">F_Q</span>, in some direction, <span class="math inline">x</span>, in terms of this gradient (<span class="math inline">\frac{dQ}{dx}</span>) and the <strong>conductivity <span class="math inline">(k_c)</span></strong> of the surface.</p>
<p><span class="math display">\begin{equation}
\tag{3.1}
    F_Q \ = \ - k_c \frac{dQ}{dx}
\end{equation}</span></p>
<p>This equation is known as <strong>Fick‚Äôs Law</strong>, and the negative sign reflects the convention that energy flows from high to low. Thus, when the gradient is increasing (positive), flow is directed away (negative). Conductance refers to the ability of the substance or surface to transport energy.</p>
<p>At the surface of the Earth, there are three important transport-driven processes ‚Äì <strong>conduction</strong>, <strong>convection</strong>, and <strong>evaporation</strong> ‚Äì each of which is associated with an energy flux.</p>
<section id="ground-heat-flux" class="level2">
<h2 class="anchored" data-anchor-id="ground-heat-flux">3.1. Ground Heat Flux</h2>
<p>The transfer of energy between two materials in contact with one another is known as <strong>conduction</strong>. Conduction is driven by temperature gradients between the two surfaces. In the Earth system context, thermal conduction of heat into the soil is quantified by the <strong>ground heat flux</strong>, <span class="math inline">G</span>. In most landscapes, very little energy is stored in the ground, so <span class="math inline">G</span> is often ignored in the landscape energy balance.</p>
</section>
<section id="sensible-heat-flux" class="level2">
<h2 class="anchored" data-anchor-id="sensible-heat-flux">3.2. Sensible Heat Flux üå°Ô∏è</h2>
<p><strong>Sensible heat flux</strong>, <span class="math inline">H</span>, refers to the loss of energy from the surface to the atmosphere via <strong>convection</strong>. Like conduction, convection is driven by differences in temperature, but this time between the <em>surface</em> and the <em>air</em>. That is,</p>
<p><span class="math display">\begin{equation}
\tag{3.2}
    H \ \propto \ T_s - T_a
\end{equation}</span></p>
<p>This proportionality between sensible heat flux and the temperature difference is determined by the properties of the surface and the turbulent flow across the surface:</p>
<p><span class="math display">\begin{equation}
\tag{3.2}
    H \ = \ k_H \rho_a c_p (T_s - T_a)
\end{equation}</span></p>
<p>where <span class="math inline">k_H</span> is the atmospheric conductivity, <span class="math inline">\rho_a</span> is the density of air, and <span class="math inline">c_p</span> is the specific heat capacity of air (at constant pressure). Heat capacity refers to the amount of energy required to change the temperature of a substance. Though <span class="math inline">c_p</span> varies slightly with air temperature, to simplify our calculations we will assume a constant value of <span class="math inline">1004.67 \text{ J kg}^{-1} \text{ K}^{-1}</span> for <span class="math inline">c_p</span>.</p>
<p>The atmospheric conductivity depends on the roughness of the surface and the wind speed. While we cannot measure this quantity directly, we can use <strong>eddy covariance</strong> to calculate <span class="math inline">H</span>. In the air, heat is transported by the turbulent flow of air in multiple layers. By averaging the product of the fluctuations of temperature and vertical wind, we can determine the amount of energy transported to or from the surface via the air ‚Äì i.e.&nbsp;the sensible heat flux. Thus, our equation for <span class="math inline">H</span> becomes</p>
<p><span class="math display">\begin{equation}
\tag{3.3}
    H \ = \ \overline{\rho_{a}} \ c_p \ \overline{w'T'}
\end{equation}</span></p>
<p>The overbars in this equation represent averages taken over a period of time when the mean vertical flow is negligible (conventionally 30 minutes). This method relies on sensors to measure the fluctuations of temperature, wind, and gas concentrations at very high frequencies in order to adequately sample the eddies that are responsible for transport. The two sensors - an anemometer and a gas analyzer ‚Äì must be a close together as possible to effectively sample the same pocket of air at the same time.</p>
<p><img src="./assets/towersensors.jpeg" alt="sensors" width="600"></p>
<p>The gas analyzer provides a measurement of the concentration of water vapor in the air, which allows for calculation of air density over time. The average air density over any period of time can be expressed as the sum of the average density of dry air, <span class="math inline">\overline{\rho_d}</span>, and the average vapor density, <span class="math inline">\overline{\rho_v}</span>:</p>
<p><span class="math display">\begin{equation}
\tag{3.4}
    \overline{\rho_{a}} \ = \ \overline{\rho_{v}} + \overline{\rho_d}
\end{equation}</span></p>
<p>Because we know the concentration of water vapor in the air, we can determine the <strong>atmospheric vapor pressure</strong> (or partial pressure of water vapor in the air), <span class="math inline">\overline{e_a}</span>. Using the ideal gas law, which relates the amount, pressure, and temperature of a gas, we can calculate vapor density:</p>
<p><span class="math display">\begin{equation}
\tag{3.5}
    \overline{\rho_v} \ = \ \frac{M_{_{\text{H}_2\text{O}}} \cdot \overline{e_a}}{R \ \overline{T_a}}
\end{equation}</span></p>
<p>where <span class="math inline">M_{_{\text{H}_2\text{O}}}</span> is the molar mass of water, <span class="math inline">R</span> is the ideal gas constant, and <span class="math inline">\overline{T_a}</span> is the average air temperature.</p>
<p>Similarly, we can compute the dry air density over the same time period using the partial pressure of dry air, which is simply the difference between total air pressure, <span class="math inline">\overline{P_a}</span>, and the vapor pressure:</p>
<p><span class="math display">\begin{equation}
\tag{3.6}
    \overline{\rho_d} \ = \ \frac{M_{_{\text{air}}} \left( \overline{P_a} \ - \ \overline{e_a}\right)}{R \ \overline{T_a}}
\end{equation}</span></p>
<p>where <span class="math inline">M_{_{\text{air}}}</span> is the molar mass of dry air.</p>
</section>
<section id="latent-heat-flux" class="level2">
<h2 class="anchored" data-anchor-id="latent-heat-flux">3.3. Latent Heat Flux üíß</h2>
<p><strong>Latent heat flux</strong>, <span class="math inline">\lambda E</span>, is the energy flux associated with phase changes (<strong>evaporation</strong> and <strong>condensation</strong>) between water at the Earth‚Äôs surface and water vapor in the air. <span class="math inline">\lambda E</span> is driven by gradients of <em>vapor pressure</em> between the surface (<span class="math inline">e_s</span>) and the air (<span class="math inline">e_a</span>):</p>
<p><span class="math display">\begin{equation}
\tag{3.7}
    \lambda E \ \propto \ e_s - \ e_a
\end{equation}</span></p>
<p>This relationship also depends on the density and total pressure of the air, the atmospheric conductivity to vapor transport, <span class="math inline">k_E</span>, and the latent heat of vaporization of water, <span class="math inline">\lambda_v</span> (the energy required to convert one mole of H<sub>2</sub>O from liquid to gas at 100<span class="math inline">^{\circ}</span>C):</p>
<p><span class="math display">\begin{equation}
\tag{3.8}
    \lambda E \ = \ k_E \lambda_v \rho_a \frac{M_{_{\text{air}}}}{M_{_{\text{H}_2\text{O}}}} \frac{e_s - e_a}{P_a}
\end{equation}</span></p>
<p>Like the sensible heat flux, it is difficult to measure <span class="math inline">\lambda E</span> directly, but we can calculate it using eddy covariance:</p>
<p><span class="math display">\begin{equation}
\tag{3.9}
    \lambda E \ = \ \overline{\rho_a} \lambda_v \overline{w' \chi_{v}'}
\end{equation}</span></p>
<p>where <span class="math inline">\chi_v</span> is the mole fraction of water vapor in the air.</p>
<p>While Equation 3.9 provides a rough approximation of latent heat flux, in practice, a number of corrections must be made to this equation to account for the separation of the sensors and the varying density of air due to both sensible and latent heat fluxes. These corrections have been implemented in a function (<code>lhf.py</code>) for ease of our computations. Thus, we can import the function and calculate <span class="math inline">\lambda E</span> as follows:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lhf <span class="im">import</span> lhf_wpl</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>lhf_wpl(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For now, we‚Äôll just import the function.</p>
<div class="run">
<pre><code>‚ñ∂Ô∏è &lt;b&gt; Run the cell below. &lt;/b&gt;</code></pre>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lhf <span class="im">import</span> lhf_wpl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr style="border-top: 0.5px solid gray; margin-top: 6pt; margin-bottom: 12pt">

</section>
<section id="problems-1" class="level2">
<h2 class="anchored" data-anchor-id="problems-1">Problems</h2>
<section id="density-of-air" class="level3">
<h3 class="anchored" data-anchor-id="density-of-air">3.1. Density of air</h3>
<p>Before calculating <span class="math inline">H</span>, it‚Äôs useful to calculate the vapor density and densities of dry and wet air.</p>
<div class="practice">
<pre><code>üìö  &lt;b&gt; Question 3.1. &lt;/b&gt; 
Use equations 3.4, 3.5, and 3.6 to calculate $\rho_v$, $\rho_d$, and $\rho_a$. Hint: be sure to convert temperature to K and check your units!. To make your life easier later on, add $T$ in K and each of the densities to the original &lt;span class="code"&gt;DataFrame&lt;/span&gt; with the following names: &lt;code&gt;'T_K'&lt;/code&gt;, &lt;code&gt;'rho_v'&lt;/code&gt;, &lt;code&gt;'rho_d'&lt;/code&gt;, and &lt;code&gt;'rho_a'&lt;/code&gt;.</code></pre>
</div>
</section>
<section id="calculate-h" class="level3">
<h3 class="anchored" data-anchor-id="calculate-h">3.2. Calculate <span class="math inline">H</span></h3>
<p>Now that you‚Äôve determined <span class="math inline">\rho_a</span>, you can use this value to calculate sensible heat flux.</p>
<div class="practice">
<pre><code>üìö  &lt;b&gt; Question 3.2. &lt;/b&gt; 
Use Equation 3.3 to determine sensible heat flux, $H$.</code></pre>
</div>
</section>
<section id="latent-heat-flux-1" class="level3">
<h3 class="anchored" data-anchor-id="latent-heat-flux-1">3.3. Latent heat flux</h3>
<div class="practice">
<pre><code>üìö  &lt;b&gt; Question 3.3. &lt;/b&gt; 
Use the &lt;code&gt;lhf_wpl&lt;/code&gt; function to determine latent heat flux, $\lambda E$.</code></pre>
</div>
</section>
<section id="comparing-turbulent-fluxes" class="level3">
<h3 class="anchored" data-anchor-id="comparing-turbulent-fluxes">3.4 Comparing turbulent fluxes</h3>
<p>Now that you‚Äôve calculated both sensible and latent heat, compare how the two vary. Consider the conditions under which <span class="math inline">H</span> and <span class="math inline">\lambda E</span> are positive or negative. What physical processes drive these fluctuations?</p>
<div class="practice">
<pre><code>üìö  &lt;b&gt; Question 3.4. &lt;/b&gt; 
Plot sensible and latent heat for the last week of each year (beginning on December 25th). Be sure your plot(s) is/are appropriately scaled and labeled. How do they compare? When does $H$ exceed $\lambda E$? When does $\lambda E$ exceed $H$? Why do are the fluxes so different for the same week of 2016 and 2019 (Hint: there is one column of data you've been provided that you have not yet used.)?</code></pre>
</div>
</section>
</section>
</section>
<section id="putting-it-all-together" class="level1">
<h1>4. Putting it all together</h1>
<hr style="border-top: 0.5px solid gray; margin-top: 10pt; margin-bottom: 12pt">

<p>Now that you have all the terms in Equation 1.2 (with the exception of <span class="math inline">G</span>, which we will assume is negligible), you can calculate the overall energy balance of the landscape:</p>
<p><span class="math display">\begin{equation}
\tag{4.1}
    \frac{dQ}{dt} \ = \ R_n \ - \ H \ - \ \lambda E
\end{equation}</span></p>
<p>In order to compare the radiation data to the flux data, you must first ensure that the two datasets have the same temporal resolution. You can do this in <span class="code">pandas</span> using <code>df.resample()</code>, which resamples the dataset over a defined interval. For our dataset, this looks like:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>rad30 <span class="op">=</span> rad.resample(pd.tseries.offsets.Minute(<span class="dv">30</span>)).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="example">
<pre><code>‚úèÔ∏è &lt;b&gt; Try it. &lt;/b&gt; 
Copy and paste the code above to generate a new &lt;span class="codeb"&gt;DataFrame&lt;/span&gt; with half-hourly averages of the radiation data. (Note that this will also resample the precipitation data, which is not useful. You can choose to either ignore this column or remove it from the new &lt;span class="codeb"&gt;DataFrame&lt;/span&gt;.</code></pre>
</div>
<section id="residual-energy" class="level3">
<h3 class="anchored" data-anchor-id="residual-energy">4.1. Residual energy</h3>
<p>Now that all the data are at the same frequency, calculate <span class="math inline">\frac{dQ}{dt}</span> using Equation 4.1.</p>
<div class="practice">
<pre><code>üìö  &lt;b&gt; Question 4.1. &lt;/b&gt; 
Calculate the residual energy flux, $\frac{dQ}{dt}$, using Equation 4.1.</code></pre>
</div>
</section>
<section id="rainfall" class="level3">
<h3 class="anchored" data-anchor-id="rainfall">4.2. Rainfall</h3>
<div class="practice">
<pre><code>üìö  &lt;b&gt; Question 4.2. &lt;/b&gt; 
Calculate daily rainfall amounts and use a bar graph to plot daily rainfall totals on two separate subplots. Which year was wetter? </code></pre>
</div>
</section>
<section id="diurnal-radiation-sensible-heat-flux-and-latent-heat-flux" class="level3">
<h3 class="anchored" data-anchor-id="diurnal-radiation-sensible-heat-flux-and-latent-heat-flux">4.3. Diurnal radiation, sensible heat flux, and latent heat flux</h3>
<p>Examine the figure you generated in 4.2 (and any of the raw data you choose ‚Äì temperature, pressure, etc.). Pick an interesting day and compare the diurnal variation in net radiation, sensible and latent heat flux, and the residual energy.</p>
<div class="practice">
<pre><code>üìö  &lt;b&gt; Question 4.3. &lt;/b&gt; 
Plot $H$, $\lambda E$, $R_n$, and the net total energy flux (i.e. the quantity you calculated in Question 4.1) across a single day in 2016 and 2019. In which year is the system closer to steady state? Discuss the differences between the two and speculate what is driving these variations.</code></pre>
</div>
</section>
<section id="average-residual-energy" class="level3">
<h3 class="anchored" data-anchor-id="average-residual-energy">4.4. Average residual energy</h3>
<p>Calculate the average residual energy, <span class="math inline">\frac{dQ}{dt}</span>, for each year.</p>
<div class="practice">
<pre><code>üìö  &lt;b&gt; Question 4.4. &lt;/b&gt; 
Calculate the average residual energy, $\frac{dQ}{dt}$, for each year.</code></pre>
</div>
</section>
<section id="energy-balance-closure." class="level3">
<h3 class="anchored" data-anchor-id="energy-balance-closure.">4.5. Energy balance closure.</h3>
<p>In addition to the sensors on the flux tower, the field site in Kenya is also equipped with soil heat flux plates that measure (you guessed it) the soil (or ground) heat flux, <span class="math inline">G</span>. Import the soil heat flux data in the cell below (the file has a single column of values of <span class="math inline">G</span> in W m<sup>-2</sup>).</p>
<div class="run">
<pre><code>‚ñ∂Ô∏è &lt;b&gt; Run the cell below. &lt;/b&gt;</code></pre>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>shf <span class="op">=</span> pd.read_csv(<span class="st">'../data/lab_2/CR3000_SN9945_Table1_ed.csv'</span>,header<span class="op">=</span><span class="dv">0</span>,names<span class="op">=</span>[<span class="st">'G'</span>],index_col<span class="op">=</span><span class="dv">0</span>,parse_dates<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="practice">
<pre><code>üìö  &lt;b&gt; Question 4.5. &lt;/b&gt; 
Re-calculate the average annual residual energy (i.e. repeat Questions 4.1 and 4.4) using the soil heat flux data and Equation 1.1. Was our previous assumption of negligible soil heat flux valid? If so, suggest a possible explanation for the discrepancy between $R_n$ and $H + \lambda E$. Otherwise, state why you think including $G$ made a difference.</code></pre>
</div>
<hr style="border-top: 1px solid gray; margin-top: 24px; margin-bottom: 1px">

<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># IGNORE THIS CELL</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.core.display <span class="im">import</span> HTML</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> css_styling():</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    styles <span class="op">=</span> <span class="bu">open</span>(<span class="st">"./styles/exercises.css"</span>, <span class="st">"r"</span>).read()</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> HTML(styles)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>css_styling()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="1">
<style>
    div.run { 
        border: 0.5px solid #008C96; 
        padding: 10px; 
        background-color: #b2dcdf; 
        color:#006269; 
        margin-top: 12px; 
        font-weight: bold
    }
    div.example { 
        border: 0.5px solid #008C96; 
        padding: 10px; 
        background-color: #b2dcdf; 
        color:#006269; 
        margin-top: 12px;
        font-weight: bold
    }
    div.practice { 
        border: 0.5px solid #008C96;  
        padding: 10px;  
        background-color: #b2dcdf;  
        color:#006269; 
        margin-top: 12px;
        font-weight: bold
    }
    div.python { 
        border: 0.5px solid #408000; 
        padding: 10px; 
        background-color: #cddfb4; 
        color:#2c5900; 
        margin-top: 12px
    }
    div.data { 
        border: 0.5px solid #443823; 
        padding: 10px; 
        background-color: #ead8b9; 
        color:#443823; 
        margin-top: 12px
    }
    div.codeblock { 
        border: 0.2px solid #808080;
        padding: 10px; 
        background-color: #DBDBDB; 
        margin-top: 2px
    }   
    div.boxhead1 { 
        border-radius: 4px 4px 0px 0px; 
        padding: 6px; 
        border: 0.5px solid #008C96; 
        background-color: #b2dcdf; 
        color:#006269; 
        margin-top: 12px; 
        font-size: 115%; 
        font-weight: bold
    }
    div.boxtext1 { 
        border-radius: 0px 0px 4px 4px; 
        border: 0.5px solid #008C96; 
        padding: 12pt; 
        color:#006269 
    }
    div.boxhead2 {
        border-radius: 4px 4px 0px 0px; 
        padding: 6px; 
        border: 0.5px solid #73AD21; 
        background-color: #c7dea6; 
        color:#486d15; 
        margin-top: 12px; 
        font-size: 115%; 
        font-weight: bold
    }
    div.boxtext2 { 
        border-radius: 0px 0px 4px 4px; 
        border: 0.5px solid #73AD21; 
        padding: 12pt; 
        color:#486d15
    }
    div.boxhead3 {
        border-radius: 4px 4px 0px 0px; 
        padding: 6px; 
        border: 0.5px solid #e66800; 
        background-color: #f7d1b2; 
        color:#cd5c00; 
        margin-top: 12px; 
        font-size: 115%; 
        font-weight: bold
    }
    div.boxtext3 { 
        border-radius: 0px 0px 4px 4px; 
        border: 0.5px solid #e66800; 
        padding: 12pt; 
        color:#cd5c00
    }
    span.code {
        font-family: Lucida Console, Courier, monospace;
        font-weight: normal;
    }
    span.codeb {
        font-family: Lucida Console, Courier, monospace;
        font-weight: bold;
    }
    ol.num {
        margin: 0pt;
        margin-top: 12pt; 
        margin-bottom: 2pt; 
        margin-left: 4pt; 
        padding-bottom: 4pt; 
    }
    ol.alpha {
        list-style-type: lower-alpha;
        margin: 0pt;
        margin-left: 4pt;
        margin-top: 2pt;
        font-weight: bold
    }
    ul.a {
        list-style-type: none; 
        margin-left: -20pt;
        font-weight: bold;
    }

    ul.b {
        list-style-type: square; 
        font-weight: normal; 
        margin-left: 20pt; 
        margin-top: 4pt; 
        padding-bottom: 12pt;
    }
</style>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>